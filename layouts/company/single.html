{{ define "title" }}
{{ T "cdb-company-title" . }} &middot; {{ .Site.Title }}
{{ end }}

{{ define "heading" }}
{{ T "cdb-company-heading" . | safeHTML }}
{{ end }}

{{ define "main" }}
<main>
    <div id="company-search"></div>
    <div id="company-details">
        {{ with .Params.categories }}<p><strong>{{ T "cdb-categories" (len .) }}</strong> {{ delimit (sort ( apply . "T" "." ) ) ", " }}</p>{{ end }}
        {{ with .Params.runs }}
            <p><strong>{{ T "cdb-runs" }}</strong></p>
            <ul>
                {{ range . }}
                    <li>{{ . }}</li>
                {{ end }}
            </ul>
        {{ end }}

        <p>{{ T "cdb-intro" . }}</p>

        {{ with .Params.address}}<p><strong>{{ T "cdb-address" }}</strong><br>{{ $.Params.name }}<br>{{ replace . "\n" "<br>" | safeHTML }}</p>{{ end }}
        {{ if or .Params.phone .Params.fax .Params.email .Params.web }}
        <table class="contact-table">
            {{ with .Params.phone }}<tr><td>{{ T "cdb-phone" }}</td><td>{{ . }}</td></tr>{{ end }}
            {{ with .Params.fax }}<tr><td>{{ T "cdb-fax" }}</td><td>{{ . }}</td></tr>{{ end }}
            {{ with .Params.email }}<tr><td>{{ T "cdb-email" }}</td><td><a href="mailto:{{ . }}">{{ . }}</a></td></tr>{{ end }}
            {{ with .Params.web }}<tr><td>{{ T "cdb-web" }}</td><td><a href="{{ . }}" rel="nofollow">{{ . }}</a></td></tr>{{ end }}
        </table>
        {{ end }}

        {{ with .Params.sources }}
            <p><strong>{{ T "cdb-sources" }}</strong></p>
            <ul>
                {{ range . }}
                    <li><a href="{{ . }}" rel="nofollow">{{ . }}</a></li>
                {{ end }}
            </ul>
        {{ end }}

        {{ with .Params.comments }}
            <p><strong>{{ T "cdb-notes" }}</strong></p>
            <ul>
                {{ range . }}
                    <li>{{ replace . "\n" "<br>" | safeHTML }}</li>
                {{ end }}
            </ul>
        {{ end }}
    </div>
    <div id="companies-help-needed" class="box box-info">
        <!-- TODO: Style properly. -->
        {{ T "cdb-help-needed" (dict "editUrl" (print ("suggest" | absURL) "?type=edit&for=cdb&slug=" .Params.slug) "newUrl" (print ("suggest" | absURL) "?type=new&for=cdb")) | safeHTML }}
    </div>
</main>
{{ end }}

{{ define "scripts" }}
<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Organization",
  "identifier": "{{ .Params.slug }}",
  "name": "{{ .Params.name }}",
  {{ with .Params.address}}"address": "{{ replace . "\n" ", " }}",{{ end }}
  {{ with .Params.runs }}
  "brand": [
    {{- /* see https://discourse.gohugo.io/t/howto-delimiter-separated-tags/146 */ -}}
    {{ range $i, $e := . }}
        {{ if $i }}, {{ end }}
        {
            "@type": "Brand",
            "name": "{{ . }}"
        }
    {{ end }}
  ],
  {{ end }}
  {{ with .Params.web }}"url": "{{ . }}",{{ end }}
  {{ if or .Params.phone .Params.fax .Params.email .Params.web }}
  "contactPoint": {
    "@type": "ContactPoint",
    {{ with .Params.phone }}"telephone": "{{ . | safeHTML }}",{{ end }}
    {{ with .Params.fax }}"faxNumber": "{{ . | safeHTML }}",{{ end }}
    {{ with .Params.web }}"url": "{{ . }}",{{ end }}
    {{ with .Params.email }}"email": "{{ . }}",{{ end }}
    "contactType": "customer support"
  }
  {{ end }}
}
</script>
{{ end }}
